"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const cdk = require("@aws-cdk/core");
const apigw = require("@aws-cdk/aws-apigateway");
const lambda = require("@aws-cdk/aws-lambda");
const path = require("path");
/**
 * Installs an endpoint in your stack that allows users to view the contents
 * of a DynamoDB table through their browser.
 */
class TableViewer extends cdk.Construct {
    constructor(parent, id, props) {
        super(parent, id);
        const handler = new lambda.Function(this, 'Rendered', {
            code: lambda.Code.asset(path.join(__dirname, 'lambda')),
            runtime: lambda.Runtime.NODEJS_12_X,
            handler: 'index.handler',
            environment: {
                TABLE_NAME: props.table.tableName,
                TITLE: props.title || '',
                SORT_BY: props.sortBy || ''
            }
        });
        props.table.grantReadData(handler);
        const home = new apigw.LambdaRestApi(this, 'ViewerEndpoint', { handler });
        this.endpoint = home.url;
    }
}
exports.TableViewer = TableViewer;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFibGUtdmlld2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidGFibGUtdmlld2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEscUNBQXNDO0FBQ3RDLGlEQUFrRDtBQUNsRCw4Q0FBK0M7QUFFL0MsNkJBQThCO0FBc0I5Qjs7O0dBR0c7QUFDSCxNQUFhLFdBQVksU0FBUSxHQUFHLENBQUMsU0FBUztJQUk1QyxZQUFZLE1BQXFCLEVBQUUsRUFBVSxFQUFFLEtBQXVCO1FBQ3BFLEtBQUssQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFFbEIsTUFBTSxPQUFPLEdBQUcsSUFBSSxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxVQUFVLEVBQUU7WUFDcEQsSUFBSSxFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBQ3ZELE9BQU8sRUFBRSxNQUFNLENBQUMsT0FBTyxDQUFDLFdBQVc7WUFDbkMsT0FBTyxFQUFFLGVBQWU7WUFDeEIsV0FBVyxFQUFFO2dCQUNYLFVBQVUsRUFBRSxLQUFLLENBQUMsS0FBSyxDQUFDLFNBQVM7Z0JBQ2pDLEtBQUssRUFBRSxLQUFLLENBQUMsS0FBSyxJQUFJLEVBQUU7Z0JBQ3hCLE9BQU8sRUFBRSxLQUFLLENBQUMsTUFBTSxJQUFJLEVBQUU7YUFDNUI7U0FDRixDQUFDLENBQUM7UUFFSCxLQUFLLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUVuQyxNQUFNLElBQUksR0FBRyxJQUFJLEtBQUssQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLGdCQUFnQixFQUFFLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQztRQUMxRSxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUM7SUFDM0IsQ0FBQztDQUNGO0FBdkJELGtDQXVCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBjZGsgPSByZXF1aXJlKCdAYXdzLWNkay9jb3JlJyk7XG5pbXBvcnQgYXBpZ3cgPSByZXF1aXJlKCdAYXdzLWNkay9hd3MtYXBpZ2F0ZXdheScpO1xuaW1wb3J0IGxhbWJkYSA9IHJlcXVpcmUoJ0Bhd3MtY2RrL2F3cy1sYW1iZGEnKTtcbmltcG9ydCBkeW5hbW9kYiA9IHJlcXVpcmUoJ0Bhd3MtY2RrL2F3cy1keW5hbW9kYicpO1xuaW1wb3J0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGFibGVWaWV3ZXJQcm9wcyB7XG4gIC8qKlxuICAgKiBUaGUgRHluYW1vREIgdGFibGUgdG8gdmlldy4gTm90ZSB0aGF0IGFsbCBjb250ZW50cyBvZiB0aGlzIHRhYmxlIHdpbGwgYmVcbiAgICogdmlzaWJsZSB0byB0aGUgcHVibGljLlxuICAgKi9cbiAgcmVhZG9ubHkgdGFibGU6IGR5bmFtb2RiLlRhYmxlO1xuXG4gIC8qKlxuICAgKiBUaGUgd2ViIHBhZ2UgdGl0bGUuXG4gICAqIEBkZWZhdWx0IC0gTm8gdGl0bGVcbiAgICovXG4gIHJlYWRvbmx5IHRpdGxlPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBOYW1lIG9mIHRoZSBjb2x1bW4gdG8gc29ydCBieSwgcHJlZml4IHdpdGggXCItXCIgZm9yIGRlc2NlbmRpbmcgb3JkZXIuXG4gICAqIEBkZWZhdWx0IC0gTm8gc29ydFxuICAgKi9cbiAgcmVhZG9ubHkgc29ydEJ5Pzogc3RyaW5nO1xufVxuXG4vKipcbiAqIEluc3RhbGxzIGFuIGVuZHBvaW50IGluIHlvdXIgc3RhY2sgdGhhdCBhbGxvd3MgdXNlcnMgdG8gdmlldyB0aGUgY29udGVudHNcbiAqIG9mIGEgRHluYW1vREIgdGFibGUgdGhyb3VnaCB0aGVpciBicm93c2VyLlxuICovXG5leHBvcnQgY2xhc3MgVGFibGVWaWV3ZXIgZXh0ZW5kcyBjZGsuQ29uc3RydWN0IHtcblxuICBwdWJsaWMgcmVhZG9ubHkgZW5kcG9pbnQ6IHN0cmluZztcblxuICBjb25zdHJ1Y3RvcihwYXJlbnQ6IGNkay5Db25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBUYWJsZVZpZXdlclByb3BzKSB7XG4gICAgc3VwZXIocGFyZW50LCBpZCk7XG5cbiAgICBjb25zdCBoYW5kbGVyID0gbmV3IGxhbWJkYS5GdW5jdGlvbih0aGlzLCAnUmVuZGVyZWQnLCB7XG4gICAgICBjb2RlOiBsYW1iZGEuQ29kZS5hc3NldChwYXRoLmpvaW4oX19kaXJuYW1lLCAnbGFtYmRhJykpLFxuICAgICAgcnVudGltZTogbGFtYmRhLlJ1bnRpbWUuTk9ERUpTXzEyX1gsXG4gICAgICBoYW5kbGVyOiAnaW5kZXguaGFuZGxlcicsXG4gICAgICBlbnZpcm9ubWVudDoge1xuICAgICAgICBUQUJMRV9OQU1FOiBwcm9wcy50YWJsZS50YWJsZU5hbWUsXG4gICAgICAgIFRJVExFOiBwcm9wcy50aXRsZSB8fCAnJyxcbiAgICAgICAgU09SVF9CWTogcHJvcHMuc29ydEJ5IHx8ICcnXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBwcm9wcy50YWJsZS5ncmFudFJlYWREYXRhKGhhbmRsZXIpO1xuXG4gICAgY29uc3QgaG9tZSA9IG5ldyBhcGlndy5MYW1iZGFSZXN0QXBpKHRoaXMsICdWaWV3ZXJFbmRwb2ludCcsIHsgaGFuZGxlciB9KTtcbiAgICB0aGlzLmVuZHBvaW50ID0gaG9tZS51cmw7XG4gIH1cbn0iXX0=